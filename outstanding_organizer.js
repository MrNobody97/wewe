if(-1==window.location.href.indexOf("scavenge"))window.open("/game.php?/&screen=place&mode=scavenge","_self");else if(null!=$("#organizer_table")[0])throw resetGlobals(),new Error("Script running!");for(var calcCheckInterval,scriptHTML=$("script:contains('loot_factor')")[0].innerHTML,levelNames=["LL","HH","CC","GG"],lootConstants={},version=game_data.version.split(" ")[0],imgSrc={organizer:"https://dsen.innogamescdn.com/asset/"+version+"/graphic/knight/skills/8.png",loading:"https://dsen.innogamescdn.com/asset/"+version+"/graphic/loading.gif"},availableUnits=[],unitCc={spear:25,sword:15,axe:10,archer:10,light:80,marcher:50,heavy:50},calculating=!1,distributionArray=[],i=0;i<levelNames.length;i++)lootConstants[levelNames[i]]={loot_factor:Number(scriptHTML.split('"loot_factor":')[2*i+1].split(",")[0]),duration_exponent:Number(scriptHTML.split('"duration_exponent":')[i+1].split(",")[0]),duration_initial_seconds:Number(scriptHTML.split('"duration_initial_seconds":')[i+1].split(",")[0]),duration_factor:Number(scriptHTML.split('"duration_factor":')[i+1].split(",")[0]),SS:{loot_factor:Number(scriptHTML.split('"loot_factor":')[2*i+2].split(",")[0])}};var ccDistribution=0,cc=0,carryCapPerUnit=25,carryCapPerLvl=0,loopLim=1e3,maxLevel=4-$(".lock").length,globalCarryCap=0,availableLevels=[];function resetGlobals(){ccDistribution=0,cc=0,carryCapPerUnit=5,carryCapPerLvl=0,maxLevel=4-$(".lock").length,calculating=!1,globalCarryCap=0,availableLevels=[],clearInterval(calcCheckInterval),$("#loading_bar")[0].innerText=""}function calcDurationSeconds(t,e){var n=lootConstants[levelNames[e]].loot_factor,a=lootConstants[levelNames[e]].duration_exponent,i=lootConstants[levelNames[e]].duration_initial_seconds,r=lootConstants[levelNames[e]].duration_factor;return Math.round((Math.pow(100*t*t*n*n,a)+i)*r)}function calcDvResPerHour(t,e,n){0==t&&(t=1);var a=lootConstants[levelNames[e]].loot_factor,i=2*lootConstants[levelNames[e]].duration_exponent,r=lootConstants[levelNames[e]].duration_initial_seconds,l=lootConstants[levelNames[e]].duration_factor,o=lootConstants[levelNames[e]].SS.loot_factor,c=Math.pow(10*a*t,i)+r,s=3600*a;return n&&(s*=o),s/(l*c)*(1-a*i*t*Math.pow(10,i)*Math.pow(a*t,i-1)/c)}function calcLoot(t,e,n){var a=Math.round(t*lootConstants[levelNames[e]].loot_factor);return n&&(a*=lootConstants[levelNames[e]].SS.loot_factor),Math.round(a)}function calcResPerHour(t,e,n){return 3600*calcLoot(t,e,n)/calcDurationSeconds(t,e)}function getRphTotal(t){for(var e=0,n=0;n<t.length;n++)e+=calcResPerHour(t[n],n,$("input[name='premium_select']")[availableLevels[n]].checked);return Math.round(e)}function getAvailableLevels(){for(var t=[!1,!1,!1,!1],e=0;e<t.length;e++){$(".scavenge-option")[e].contains($("a[class*='free_send_button']",$(".scavenge-option")[e])[0])&&(t[e]=!0)}return t}function setupUi(){var t=document.createElement("DIV"),e=document.createAttribute("class"),n=document.createAttribute("id");e.value="scavenge-option border-frame-gold-red",n.value="outstanding_organizer",t.setAttributeNode(e),t.setAttributeNode(n);for(var a="<th>Level</th><th><span title='+20%' class='coinbag coinbag-header'></span></th>",i="",r="<td><b>Total:</b></td><td></td>",l=["","","",""],o="",c="<select name='levels' onchange='levelChange()' value = '5'>",s=getStoredUnits(),u=getAvailableLevels(),p=1;p<5;p++)c+="<option value = '"+p+"'>"+p+"</option>";i+="<td>"+(c+="<option value='5' selected>*</option></select></td><td><input style='display:block;width:16px' title='Select all' onclick='premiumSelectAll()' type='checkbox'></td>")+"</td>";var d=$(".unitsInput").length;"knight"==$(".unitsInput")[d-1].name&&d--;for(p=0;p<d;p++){a+="<th>"+$(".unit_link").parent()[p].innerHTML+"</th>",availableUnits.push($(".unitsInput").parent()[p].innerHTML.split('name="')[1].split('"')[0]),i+="<td>"+$(".unitsInput").parent()[p].innerHTML.replace('value="','value="'+s[p]).split("<a")[0],i+=($(".unitsInput").parent()[p].innerHTML.split(">")[1]+">"+$(".unitsInput").parent()[p].innerHTML.split(">")[2]+">").replace('href="#"',"onclick=\"fillUnit('"+availableUnits[p]+"')\"")+"</td>",r+="<td>0</td>";for(var h=0;h<l.length;h++)l[h]+="<td>0</td>"}for(p=0;p<l.length;p++)o+="<tr class='command-row "+(u[p]?"":"grey")+"'><td style='white-space:nowrap'><button class='"+(u[p]?"btn":"btn btn-disabled")+"' title='Fill' onclick = 'fillScavInputs("+p+")'><b>Lvl "+(p+1)+"</b></button></td><td><input name='premium_select' style='display:block;width:16px' type='checkbox'></td>"+l[p]+"<td style='white-space: nowrap'>0 <span class='icon header res'></span></td><td>0</td></tr>";a+="<th style='width:100%'>All</th><th title='Resources per hour'>RPH</th>",i+="<td><span style='cursor:pointer' title='Save current input' onclick='saveUnits()' class='icon header inventory'></span><br><a style = 'white-space:nowrap;display:block;width:100px' class='fill-all' onclick='inputAllTroops()'>All troops</a></td>    <td><button class='btn' name='distribute' onclick='distributeClick()' style='width:78px;height:24px;align-items:center'><span id='loading_bar' style='position:absolute;margin-left:-25px;margin-top:1px;height:14px;font-family:verdana;background-color:gray;color:gray'></span>    <img rel='prefetch' style='display:none' src='"+imgSrc.loading+"'>Distribute</div></button></td>",t.innerHTML="<table><td><div style='text-align:center; float:left; width:175px'><img src='"+imgSrc.organizer+"'><div class='title'>Outstanding Organizer</div></div>        </td><td><div class='candidate-squad-container' style='float:left'><table class='candidate-squad-widget vis' id='organizer_table' style='width:100%'><tbody><tr>"+a+"</tr><tr>        "+i+"</tr>        "+o+"<tr>"+r+"<td style='white-space: nowrap'>0 <span class='icon header res'></span></td><td>0</td></tr></tbody></table></td></table></div>",$("#content_value")[0].appendChild(t),levelChange()}function saveUnits(){$("span[title='Save current input']")[0].setAttribute("style","cursor:progress");for(var t="",e=$(".unitsInput","#organizer_table"),n=0;n<e.length;n++)t+=e[n].name+":"+e[n].value,n!=e.length-1&&(t+=",");localStorage.setItem("oo_units",t),setTimeout(function(){$("span[title='Save current input']")[0].setAttribute("style","cursor:pointer")},100)}function getStoredUnits(){var t=localStorage.getItem("oo_units");if(null==t)t=Array.apply(null,Array(10)).map(function(t,e){return""});else{t=t.split(",");for(var e=0;e<t.length;e++)t[e]=t[e].split(":")[1]}return t}function distributeClick(){if(changeButton(),resetGlobals(),0==$("button[class='btn'][title='Fill']",$("#organizer_table")).length)return changeButton(),0;setTimeout(function(){initializeCalc()},50)}function fillScavInputs(t){try{for(var e=$(".btn",$(".command-row")).parent().parent()[t].children,n=$("input",$(".candidate-squad-widget")[0]),a=0;a<e.length-4;a++)n[a].value=e[a+2].innerHTML,$("input[name='"+n[a].name+"']",$(".candidate-squad-widget")[0]).change()}catch(t){return}}function initializeCalc(){maxLevel=4-$(".btn-disabled",$(".command-row")).length,globalCarryCap=getCarryCap(),calcCheckInterval=setInterval(initializeGetDistribution,5)}function initializeGetDistribution(){if(!calculating)return 0!=ccDistribution?(clearInterval(calcCheckInterval),void initializeUnitDistribution()):($("#loading_bar")[0].innerText=".".repeat(Math.round(cc/globalCarryCap*17)),void getDistributions())}function initializeUnitDistribution(){for(var t=getUnitDistribution(ccDistribution[0]),e=0,n=[],a=[],i=0;i<ccDistribution[0].length;i++){ccDistribution[0][i]=0;for(var r=0;r<t[i].length;r++)ccDistribution[0][i]+=t[i][r]*unitCc[$(".unitsInput",$("#organizer_table"))[r].name];$("input[name='premium_select']")[availableLevels[i]].checked&&(ccDistribution[0][i]*=lootConstants[levelNames[i]].SS.loot_factor),n.push(Math.round(calcResPerHour(ccDistribution[0][i],availableLevels[i],$("input[name='premium_select']")[availableLevels[i]].checked))),e+=n[i]}for(i=0;i<t[0].length;i++){a.push([0]);for(r=0;r<t.length;r++)a[i]=Number(a[i])+Number(t[r][i])}inputResults(t,ccDistribution[0],n,globalCarryCap,e,a),resetGlobals(),changeButton()}function changeButton(){var t=$("button[name='distribute']")[0];"Distribute"==t.innerText?(t.innerHTML=t.innerHTML.replace("Distribute",""),t.children[1].setAttribute("style","position:relative;bottom:4px"),t.setAttribute("class","btn btn-disabled"),t.setAttribute("onclick","cancelCalc()")):(t.children[1].setAttribute("style","display:none"),t.innerHTML=t.innerHTML.replace("","Distribute"),t.setAttribute("class","btn"),t.setAttribute("onclick","distributeClick()"))}function cancelCalc(){throw changeButton(),resetGlobals(),new Error("Calculation canceled!")}function inputResults(t,e,n,a,i,r){for(var l=$("button[class='btn']",$(".command-row")).parent().parent(),o=$("tr","#organizer_table")[$("tr","#organizer_table").length-1],c=0;c<l.length;c++){for(var s=0;s<l[0].children.length-3;s++)l[c].children[s+2].innerHTML=t[c][s];l[c].children[l[c].children.length-2].innerHTML=formatNumber(e[c])+" <span class='icon header res'></span>",l[c].children[l[c].children.length-1].innerHTML=formatNumber(n[c])}for(c=2;c<o.children.length-2;c++)o.children[c].innerHTML=r[c-2];o.children[o.children.length-2].innerHTML=formatNumber(a)+" <span class='icon header res'></span>",o.children[o.children.length-1].innerHTML=formatNumber(i)}function formatNumber(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}function getUnitDistribution(t){var e=$(".unitsInput",$("#organizer_table")),n=1,a=0;unitValue=0,unitDistribution=[],unitSum=[];for(var i=0;i<t.length;i++)a+=t[i];for(i=0;i<t.length;i++){n=t[i]/a,unitDistribution.push([]);for(var r=0;r<e.length;r++)0==i&&unitSum.push(0),unitValue=Number(e[r].value),unitDistribution[i].push(Math.floor(unitValue*n)),unitSum[r]+=Math.floor(unitValue*n)}for(i=0;i<unitSum.length;i++){r=0;for(var l=unitSum[i];r<e[i].value-l;r++)unitSum[i]++,unitDistribution[t.length-1-r%t.length][i]++}return unitDistribution}function getDistributions(){if(calculating=!0,0==cc){carryCapPerLvl=Array.apply(null,Array(maxLevel)).map(function(t,e){return 0});for(var t=0;t<$("button[class='btn']",$(".command-row")).length;t++)availableLevels.push($("button[class='btn']",$(".command-row"))[t].innerHTML.split(" ")[1].split("<")[0]-1)}for(var e=Array.apply(null,Array(maxLevel)).map(function(t,e){return 0}),n=0,a=0;cc<=globalCarryCap;){for(t=0;t<maxLevel;t++)e[t]=calcDvResPerHour(carryCapPerLvl[t],availableLevels[t],$("input[name='premium_select']")[availableLevels[t]].checked);if(n=e.indexOf(Math.max(...e)),carryCapPerLvl[n]=carryCapPerLvl[n]+carryCapPerUnit,cc+=carryCapPerUnit,++a>loopLim)return void(calculating=!1)}calculating=!1,ccDistribution=[carryCapPerLvl,getRphTotal(carryCapPerLvl)]}function getCarryCap(){for(var t=$(".unitsInput",$("#organizer_table")),e=0,n=0;n<t.length;n++)e+=""==t[n].value?0:Number(t[n].value*unitCc[t[n].name]);return e}function levelChange(){for(var t=$("select[name='levels']")[0].value,e=[],n=getAvailableLevels(),a=0;a<4;a++)n[a]?e.push("checked"):e.push("");for(a=0;a<4;a++)a<t?$(".command-row")[a].setAttribute("class","command-row"):$(".command-row")[a].setAttribute("class","command-row grey"),a<t?$(".btn",$(".command-row"))[a].setAttribute("class","btn"):$(".btn",$(".command-row"))[a].setAttribute("class","btn btn-disabled"),5==t?null==$("input[onchange*='checkboxChange']",$(".command-row")[a])[0]&&(a>=maxLevel&&e.push(""),$(".command-row")[a].children[0].innerHTML="<input type='checkbox' style='width:15px' onchange='checkboxChange("+a+")' "+e[a]+">"+$(".command-row")[a].children[0].innerHTML,""==e[a]&&checkboxChange(a)):null!=$("input[onchange*='checkboxChange']",$(".command-row")[a])[0]&&($(".command-row")[a].children[0].innerHTML=$(".command-row")[a].children[0].children[1].outerHTML)}function checkboxChange(t){$(".command-row")[t].children[0].children[0].checked?$(".command-row")[t].setAttribute("class","command-row"):$(".command-row")[t].setAttribute("class","command-row grey"),$(".command-row")[t].children[0].children[0].checked?$(".btn",$(".command-row"))[t].setAttribute("class","btn"):$(".btn",$(".command-row"))[t].setAttribute("class","btn btn-disabled")}function inputAllTroops(){for(var t=$(".unitsInput","#organizer_table"),e=$(".units-entry-all","#organizer_table"),n=!0,a=0;a<t.length;a++)""==t[a].value&&(t[a].value=0),t[a].value!=e[a].innerHTML.split("(")[1].split(")")[0]&&(n=!1);for(a=0;a<t.length;a++)valueToInput=t[a].value=$(".units-entry-all","#organizer_table")[a].innerHTML.split("(")[1].split(")")[0],n?t[a].value="":0==valueToInput?t[a].value="":t[a].value=valueToInput}function fillUnit(t){var e=$("a[onclick=\"fillUnit('"+t+"')\"]")[0].innerHTML.split("(")[1].split(")")[0];$("input[name="+t+"]")[1].value!=e&&0!=e||(e=""),$("input[name="+t+"]")[1].value=e}function premiumSelectAll(){for(var t=0;t<$("input[name='premium_select']").length;t++)$("input[name='premium_select']")[t].checked=$("input[onclick='premiumSelectAll()']")[0].checked}setupUi();
